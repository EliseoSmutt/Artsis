<!DOCTYPE html>
<html lang="en">
<head>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        google.charts.load('current', { 'packages': ['corechart'] });
        google.charts.setOnLoadCallback(initialize);

        var chart;

        function initialize() {
            var currentYear = new Date().getFullYear();
            cargarDatosDelAnio(currentYear);
        }

        function cargarDatosDelAnio(year) {
            var url = 'https://localhost:7077/api/Abonado/abonados-reserva-libros?year=' + year;
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    console.log("Datos recibidos:", data);

                    if (data.cantidadTotalAbonados === 0) {
                        document.getElementById('chart_div').innerHTML = "<p>No hay abonados en el año seleccionado.</p>";
                        return;
                    }

                    drawChart(data.abonadosReserva, data.abonadosNoReserva);
                })
                .catch(error => {
                    console.error('Error al obtener datos:', error);
                    document.getElementById('chart_div').innerHTML = "<p>Error al obtener datos.</p>";
                });
        }

        function drawChart(abonadosReserva, abonadosNoReserva) {
            var data = google.visualization.arrayToDataTable([
                ['Tipo', 'Cantidad'],
                ['Con reserva', abonadosReserva],
                ['Sin reserva', abonadosNoReserva]
            ]);

            var options = {
                pieHole: 0.4, // Si querés estilo donut
                colors: ['#b11c3c', '#555555'],
                backgroundColor: '#040006',
                chartArea: {
                    top: 25,
                    bottom: 80,
                    left: '28%',
                    width: '90%', // Ajustar ancho del área del gráfico
                    height: '90%' // Ajustar altura del área del gráfico
                },
                pieSliceTextStyle: {//etiquetas
                    fontSize: 23,
                    bold: true,
                    color: '#DFD9BB'
                },
                legend: {// leyendas
                    position: 'right',
                    alligment: 'center',
                    textStyle: {
                        color: '#DFD9BB',
                        fontSize: 18
                    }
                }
            }

            var chart = new google.visualization.PieChart(document.getElementById('chart_div'));
            chart.draw(data, options);
        }

        function onYearChange() {
            var selectedYear = document.getElementById('yearSelect').value;
            cargarDatosDelAnio(selectedYear);
        }

    </script>
    <style>
        body {
            background-color: #040006;
            color: white;
            font-family: Arial, sans-serif;
            margin: 0
        }

        #selectors-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            margin-top: 30px;
        }

        select {
            background-color: #DFD9BB;
            font-size: 18px;
            padding: 10px;
            width: 200px;
            height: 50px;
            margin: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        #chart_div {
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            background-color: #040006;
            margin-top: 20px;
            margin-bottom: 15px;
            width: 100%;
            height: 80%;
        }
    </style>
</head>
<body>
    <div id="selectors-container">
        <select id="yearSelect" onchange="onYearChange()">
        </select>
        <script>
            var currentYear = new Date().getFullYear();
            var select = document.getElementById('yearSelect');
            for (var y = currentYear; y > currentYear - 5; y--) {
                var opt = document.createElement('option');
                opt.value = y;
                opt.textContent = y;
                if (y === currentYear) opt.selected = true;
                select.appendChild(opt);
            }
        </script>
    </div>
    <h2 id="chart-title" style="text-align: center; color: #DFD9BB; margin: 10px 0; font-size: 24px;">
        Abonados con y sin reservas de libros
    </h2>
        <div id="chart_div"></div>

</body>
</html>
